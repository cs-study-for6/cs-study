# TLS/SSL

## TLS (Transport Layer Security)
TLS란 넷스케이프 커뮤니케이션스사가 개발한 SSL(Secure Sockets Layer)에 기반한 인터넷에서의 정보를 암호화하여 송수신하는 프로토콜로, 국제 인터넷 표준화 기구에서 표준으로 인정받은 프로토콜이다.
<br/>
인터넷을 사용한 통신에서 보안을 확보하려면 두 통신 당사자가 서로가 신뢰할 수 있는 자임을 확인할 수 있어야 하며, 서로간의 통신 내용이 제3자에 의해 도청되는 것을 방지해야 한다. 따라서 서로 자신을 신뢰할 수 있음을 알리기 위해 전자 서명이 포함된 인증서를 사용하며, 도청을 방지하기 위해 통신 내용을 암호화한다. 이러한 통신 규약을 묶어 정리한 것이 바로 TLS이며, 웹브라우저 주소창에 자물쇠 아이콘이 뜨는 것으로 TLS의 적용 여부를 확인할 수 있다.
<br/>
TLS 버전 1.0은 SSL 버전 3.1을 기반으로 개발을 시작했지만 넷스케이프와는 더 이상 관계가 없음을 명시하기 위해 발표 전에 프로토콜의 이름이 변경되었다. 그러나 이미 깊은 연관이 있는 두 단어는 종종 혼용되고 있다.

## HTTPS
TLS를 사용해 암호화된 연결을 하는 HTTP를 HTTPS(HTTP Secure)라고 하며, 웹사이트 주소 역시 http://가 아닌 https://로 시작된다. 기본 포트는 80번이 아닌 443번을 쓴다. 2024년 기준 크롬에서 열리는 페이지 중 96% 이상은 HTTPS를 사용한다.
<blockquote style="color:yellow"><em><strong>그런데 여기서 TLS = HTTPS는 아니다!!</strong></em></blockquote>
<br>
TLS는 다양한 종류의 보안 통신을 하기 위한 프로토콜이며, HTTPS는 TLS 위에 HTTP 프로토콜을 얹어 보안된 HTTP 통신을 하는 프로토콜이다. 다시 말해 TLS는 HTTP뿐만이 아니라 FTP, SMTP와 같은 여타 프로토콜에도 적용할 수 있으며, HTTPS는 TLS와 HTTP가 조합된 프로토콜만을 가리킨다.

## 대칭키/공개키
대칭키 암호(symmetric-key algorithm)는 암호화와 복호화에 같은 열쇠(key)를 사용하는 암호를 말한다. 반대로, 암호화와 복호화에 서로 다른 열쇠를 사용하는 것은 공개키 암호(public-key cryptography) 또는 비대칭키 암호라고 한다.
<br/>
대칭키 암호는 암복호화 속도가 빠르지만 상대편도 같은 열쇠를 가지고 있어야 하므로 이를 전달하는 과정에서 약점이 노출되며, 공개키 암호는 상대편에게 열쇠를 쉽게 전달할 수 있지만 암복호화가 오래 걸린다.
<br/>
대칭키 암호의 대표적인 예는 AES와 DES이며, 공개키 암호의 대표적인 예가 RSA 암호화이다. 후술할 TLS 연결 세션에서는 하드웨어 자원을 상대적으로 적게 소모하는 대칭키 암호를 사용한다.



## 작동 방법
TLS 연결은 TLS Handshake로 알려진 일련의 순서를 사용하여 초기화한다.
1. 클라이언트에서 서버에 ClientHello 메시지를 보낸다. 여기에는 클라이언트에서 사용 가능한 TLS 버전, 서버 도메인, 세션 식별자, 암호 설정 등의 정보가 포함된다.
2. 클라이언트의 메시지를 받은 서버는 ServerHello 메시지를 클라이언트에게 보낸다. 여기에는 ClientHello 메시지의 정보 중 서버에서 사용하기로 선택한 TLS 버전, 세션 식별자, 암호 설정 등의 정보가 포함된다.
3. 서버가 클라이언트에 Certificate 메시지를 보낸다. 여기에는 서버의 인증서가 들어간다. 이 인증서는 별도의 인증 기관에서 발급받은 것이며, 서버가 신뢰할 수 있는 자임을 인증한다. 전송이 끝나면 ServerHelloDone 메시지를 보내 끝났음을 알린다.
4. 클라이언트는 서버에서 받은 인증서를 검증한다. 인증서의 유효 기간이 만료되지 않았는지, 그 인증서가 해당 서버에게 발급된 인증서가 맞는지 등을 확인한다. 인증서를 신뢰할 수 있다고 판단하였다면 다음 단계로 넘어간다.
5. 클라이언트는 임의의 pre-master secret을 생성한 뒤, 서버가 보낸 인증서에 포함된 공개 키를 사용해 암호화한다. 이렇게 암호화된 pre-master secret을 ClientKeyExchange 메시지에 포함시켜 서버에 전송한다.
6. 서버는 전송받은 정보를 복호화하여 pre-master secret을 알아낸 뒤, 이 정보를 사용해 master secret을 생성한다. 그 뒤 master secret에서 세션 키를 생성해내며, 이 세션 키는 앞으로 서버와 클라이언트 간의 통신을 암호화하는 데 사용될 것이다. 물론 클라이언트 역시 자신이 만들어낸 pre-master secret을 알고 있으므로, 같은 과정을 거쳐 세션 키를 스스로 만들 수 있다.
7. 이제 서버와 클라이언트는 각자 동일한 세션 키를 가지고 있으며, 이 키를 사용해 대칭키 암호를 사용하는 통신을 할 수 있다. 따라서 우선 서로에게 ChangeCipherSpec 메시지를 보내 앞으로의 모든 통신 내용은 세션 키를 사용해 암호화해 보낼 것을 알려준 뒤, Finished 메시지를 보내 각자의 핸드셰이킹 과정이 끝났음을 알린다.
8. 이제 서버와 클라이언트 간에 보안 통신이 구성된다.

데이터카 암호화되고 인증되고 나면, 메시지 인증 코드(MAC)와 함께 서명되며, 수신자는 데이터의 무결성을 보장하기 위해 MAC를 확인할 수 있다.

## TLS의 장단점
### 장점
기존 HTTP의 문제점은 크게 다음과 같이 세 가지로 정리할 수 있다.
1. 데이터가 암호화가 되어있지 않고 평문으로 되어있어서 제 3자가 패킷을 살펴볼 수 있다.
2. 서로 데이터가 완전한지 확인하지 않아 제 3자가 데이터를 악의적으로 위변조할 수 있다.
3. 서로 신뢰할 수 있는 상대인지 확인하지 않는다.
TLS는 이를 다음과 같은 강점으로 보완한다.
1. 데이터를 클라이언트와 서버끼리만 확인할 수 있도록 데이터를 암호화한다.
2. 인증서 및 인증기관(Certificate Authority; CA)이라는 개념을 등장시켜 서버의 신분을 확인할 수 있는 인증 과정을 거친다.

### 문제점
1. 인증 기관이 제대로 확인되지 않은 인증서를 발급한다면 더 이상 그 인증서를 신뢰할 수가 없게 된다.
2. TLS는 망연결에서의 보안을 책임지고 있으므로, 연결된 단말기가 해킹당한 경우라면 무용지물이 된다.
3. TCP 프로토콜을 이용하기 때문에 성능 보완을 위해서는 UDP 기반의 보안 소켓이 필요하다.


## 참고자료
https://aws.amazon.com/ko/compare/the-difference-between-ssl-and-tls/
<br/>
https://www.cloudflare.com/ko-kr/learning/ssl/transport-layer-security-tls/
<br/>
https://cuziam.tistory.com/entry/TLSHTTPS%EC%9D%98-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC%EC%99%80-%EA%B3%BC%EC%A0%95
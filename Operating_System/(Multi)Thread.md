# Thread(스레드)
스레드(thread)란 프로세스(process) 내에서 실행되는 작은 작업 단위로, 다시말해 실제로 작업을 수행하는 주체를 의미합니다.
모든 프로세스에는 한 개 이상의 스레드가 존재하여 작업을 수행하며, 이때 스레드는 프로세스의 실행 흐름을 구성하는 단위라 볼 수 있습니다.
또한, 두 개 이상의 스레드를 가지는 프로세스를 멀티스레드 프로세스(multi-threaded process)라고 합니다.


+ 프로세스(process)란 단순히 실행 중인 프로그램(program)이라고 할 수 있습니다.
즉, 사용자가 작성한 프로그램이 운영체제에 의해 메모리 공간을 할당받아 실행 중인 것을 말합니다.
이러한 프로세스는 프로그램에 사용되는 데이터와 메모리 등의 자원 그리고 스레드로 구성됩니다.

## 스레드의 특징
1) 서로의 데이터에 직접적 접근이 불가능한 프로세스들과 달리, 스레드는 프로세스 내부에 존재하기에 프로세스의 데이터 영역에 접근이 가능하며,
스레드간의 데이터 접근이 가능합니다.
 
3) 스레드는 작업 단위로서 프로세스처럼 작업을 처리하며, 프로세스처럼 작업을 병렬로 처리해서 속도를 높일 수 있습니다.
 
4) 스레드는 일종의 함수로 구현되며, 따라서 데이터(지역변수)를 다루고, 이를 관리하기 위한 stack 메모리 영역을 가집니다.
이때 이 스텍공간은 프로세스와는 별개의 스텍 메모리를 가지고 있으며, thread stack이라 불립니다.
프로세스는 메모리 영역을 크게 4가지(code, data, stack, heap)으로 나눌 수 있지만, 스레드는 thread stack 메모리 공간만 가지고 있습니다.



## 스레드의 장점
1)응답성(성능) 향상
스레드 간의 작업 분할과 병렬 처리로 인해 사용자가 응용 프로그램을 원활하게 사용하는데 빠른 응답성(결과)를 제공할 수 있습니다.

2) 자원 공유 효율성 향상
스레드는 하나의 프로세스 내에서 실행되기 때문에, 별도 기법 없이 프로세스의 자원을 공유하여 접근할 수 있습니다.
또한 프로세스 내부에 있기 때문에 별도의 메모리 공간을 할당할 필요없이, 프로세스 내부에서 데이터를 관리하면 됩니다.
이때 프로세스 내부인 thread stack에 데이터를 관리하기 때문에 자원 공유의 효율이 높습니다.

3) 동시성
여러 개의 스레드가 동시에 실행될 수 있어서, 작업을 병렬로 처리할 수 있습니다.

4) 간결성
작업을 분리할 수 있어서 코드를 간결하게 구성할 수 있습니다.


## 스레드의 단점
1) 스레드 간의 상호간섭
멀티 스레드가 실행 중인 상황에, 스레드 간의 상호간섭 문제가 발생할 수 있습니다.
프로세스는 한 개가 다운되면, 그 프로세스만 작업이 멈추고 다른 프로세스에는 영향이 가지 않는반면, 스레드는 다른 스레드가 작업을 방해하거나, 스레드간의 우선순위 설정에 문제가 있을 경우, 서로에게 영향을 미치기 때문에 예상치 못한 이슈가 발생할 수 있습니다.

2) 성능 저하
스레드를 많이 생성하면 성능 저하가 발생할 수 있습니다.
이는 다수의 스레드가 작동할 경우 스레드 스케줄러에서, 각 스레드의 병렬 실행을 위해 컨텍스트 스위칭이 빈번하게 발생해야 하기 때문입니다.

3) 동기화 이슈
여러 스레드가 공유 자원에 동시에 접근할 때, 동기화 문제가 발생할 수 있습니다.
경쟁 상태(Race Condition) 문제등, 스레드 간의 실행 순서나 타이밍에 따라 예측할 수 없는 결과가 발생할 수 있다. 

4) 자원 소비
스레드는 개별적인 실행 흐름을 가지기 때문에, 스레드마다 stack 및 레지스터 등의 메모리 자원을 소비합니다.
따라서 스레드의 수가 증가하면 메모리 사용량도 증가하게 되어 시스템 자원이 한계에 도달할 수 있습니다.


## 자바에서의 스레드
- 생성방법 : 1. Runnable 인터페이스로 구현 2. Thread 클래스 상속받기
- 다만 Thread 클래스를 상속받으면 타 클래스를 상속받을수 없기에 일반적으로 Runnable 인터페이스(몸체가 없는 메소드인 run() 메소드 단 하나만을 가지는 간단한 인터페이스)를 구현합니다.

### 자바에서의 스레드 우선순위
자바에서 각 스레드는 우선순위(priority)에 관한 자신만의 필드를 가지고 있습니다.
이러한 우선순위에 따라 특정 스레드가 더 많은 시간 동안 작업을 할 수 있도록 설정할 수 있습니다.
getPriority()와 setPriority() 메소드를 통해 스레드의 우선순위를 반환하거나 변경할 수 있습니다.
스레드의 우선순위가 가질 수 있는 범위는 1부터 10까지이며, 숫자가 높을수록 우선순위 또한 높아집니다.
이때 스레드의 우선순위는 해당 스레드를 생성한 스레드의 우선순위를 상속받게 됩니다.
![image](https://github.com/ELS-7/CS-Ready/assets/104435415/b4df58e9-f000-4e89-a841-ddee0b631628)

-스레드 작성 자바 코드 예시 : https://www.tcpschool.com/java/java_thread_concept#google_vignette



# Multi Thread(멀티 스레드)
멀티 스레드는 하나의 프로세스 내부에서 여러 개의 스레드가 동시에 실행되는 것입니다.
자세히 말하자면, 하나의 프로세스를 다수의 실행 단위로 구분하여 자원을 공유하고, 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 향상시키는 것입니다.
이를 통해 하나의 프로그램에 동시에 여러개의 일을 수행할수 있도록 해주는 것입니다.

스레드끼리는 서로의 메모리 공간(thread stack)을 공유하고 접근할 수 있으며, 이 과정은 IPC 통신이 아닌 메모리 기반 통신을 사용하기에 통신 속도가 빠릅니다.
각 스레드들은 여러 자원을 공유하기에, 하나의 스레드에 문제가 생기면 나머지 스레드들도 영향을 받을 수 있고, 프로세스 내에서 스레드의 작업을 여러개로 분할(쪼개서) 병렬로 처리할 수 있습니다.

+ 멀티 프로세스는 여러 개의 독립적인 프로세스가 동시에 실행되는 것입니다. 각 프로세스는 독립된 메모리 공간을 가지며, 서로에게 접근하려면 IPC 기법을 사용해야 합니다.
각 프로세스는 각각 고유한 자원을 관리하고 있어 서로에게 영향을 미치지 않으며, 하나의 프로세스 작업을 여러개로 분할(쪼개서) 병렬로 처리할 수 있습니다. 이때, 프로세스는 스레드 단위로 작업을 분할합니다.

이에 따라 프로세스를 이용하여 동시에 처리하던 일을 쓰레드로 구현할 경우 메모리 공간과 시스템 자원 소모가 줄어들게 됩니다.
쓰레드 간의 통신이 필요한 경우에도 별도의 자원을 이용하는 것이 아니라 전역 변수의 공간 또는 동적으로 할당된 공간인 힙(Heap) 영역을 이용하여 데이터를 주고받을 수 있기 때문에, 프로세스간 통신에 비해 통신이 훨씬 간단합니다.
또한, 쓰레드의 문맥 교환은 프로세스 문맥 교환과는 달리 캐시 메모리를 비울 필요가 없기 때문에 더 빠릅니다.
따라서 시스템의 처리량이 향상되고 자원 소모가 줄어들어 자연스럽게 프로그램의 응답 시간이 단축됩니다.
이러한 장점 때문에 여러 프로세스로 할 수 있는 작업들을 하나의 프로세스에서 여러 쓰레드로 나눠 수행하는 것입니다.


## 멀티 쓰레딩의 장점
1) 멀티 쓰레드에서 쓰레드간 스택 영역만 비공유하고 데이터 영역과 힙 영역을 공유합니다.

2) 쓰레드의 생성 및 컨텍스트 스위칭은 프로세스의 생성 및 컨텍스트 스위칭보다 빠릅니다.

3) 멀티 쓰레드 컨텍스트 스위칭 시 데이터 영역과 힙을 뮤올리고 내릴 필요가 없습니다.

4) 데이터 영역과 힙 영역을 통해 데이터 교환이 가능합니다.

5) 쓰레드 사이에서의 데이터 교환에서는 특별한 기법이 필요없습니다.


## 멀티 쓰레딩의 문제점
1) 멀티 프로세스 기반으로 프로그래밍할 때는 프로세스 간 공유하는 자원이 없기 때문에
동일한 자원에 동시에 접근하는 일이 없었지만,멀티 쓰레딩을 기반으로 프로그래밍할 때는 이 부분을 따로 신경써줘야 합니다.

2) 서로 다른 쓰레드가 데이터와 힙 영역을 공유하기 때문에
어떤 쓰레드가 다른 쓰레드에서 사용중인 변수나
자료 구조에 접근하여 엉뚱한 값을 읽어오거나 수정할 수 있습니다.
(이것이 곧 동기화 작업이 필요한 이유로, 동기화를 통해 작업 처리 순서를 컨트롤 하고
공유 자원에 대한 접근을 컨트롤 하는 것입니다.)

3) 동기화 작업으로 인해 병목 현상이 발생하여 성능이 저하될 가능성이 높기에, 과도한 락(lock)으로 인한 병목 현상을 줄여야 합니다.

+ 공유 자원이 아닌 부분은 동기화 처리를 할 필요가 없습니다. 즉, 동기화 처리가 필요한 부분에만 synchronized 키워드를 통해 동기화하는 것이다.
불필요한 부분까지 동기화를 할 경우 현재 쓰레드는 락(lock)을 획득한 쓰레드가 종료하기 전까지 대기해야 하며, 그렇게 되면 전체 성능에 영향을 미치게 됩니다.
즉 동기화를 하고자 할 때는 메소드 전체를 동기화 할 것인가 아니면 특정 부분만 동기화할 것인지 고민해야 합니다.


## 멀티 프로세스와 멀티 쓰레드의 차이점
멀티 프로세스 : [데이터 영역, 힙, 스택 ]영역 모두를 비공유

멀티 쓰레드 : [ 데이터 영역, 힙, 스택 ]영역중 스택 영역만 비공유


